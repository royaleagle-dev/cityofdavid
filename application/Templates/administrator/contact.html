{% extends "administrator/base.html" %}

{% block title %}
Contact Messages
{% endblock %}

{% block CSS %}

{% endblock %}

{% block content %}
<div class="panel-heading">
	<h3 class="panel-title"><a href="javascript:void(0);" class="toggle-sidebar"><span class="fa fa-angle-double-left" data-toggle="offcanvas" title="Maximize Panel"></span></a>Contact Messages</h3>
</div>
<div class="panel-body">
	<div class="content-row">
		<div class = "row">
			<div class = "col p-2">
                @php foreach($contact_messages as $message): @endphp
                <div style = "border-left: 2px solid blue;">
                    <div style = "padding:10px;">
                        <div style = "margin-bottom:10px;">
                            <h4 style = "display:inline;">{{$message->subject}}</h4>
                            <small>{{$message->date_sent}}</small>
                            @php if($message->replied): @endphp
                            <button class = "btn btn-success" disabled style = "float:right;">Replied</button>
                            @php else: @endphp
                            <a href = "{% url replyMessage %}/{{$message->id}}" class = "btn btn-warning" style = "float:right;">Reply</a>
                            @php endif; @endphp
                        </div>
                        <p style = "font-size:1.5rem;">{{$message->message}}</p>
                        <hr>
                    </div>
                </div>
                @php endforeach; @endphp
            </div>
		</div>
		<hr>
	</div>
</div>
{% endblock %}

{% block JS %}
<script>
	function confirmDeleteSubscriber(subscriber_email, count){
        const deleteSubscriber = confirm("Do you really want to delete this subscriber.");
        if(deleteSubscriber){
            subscriberDelete(subscriber_email, count);
        }
    }

    function subscriberDelete(subscriber_email, count){
        const url = "{% url deleteSubscriber %}"
        $.post(url, {'email':subscriber_email}, function(response){
            const data = JSON.parse(response);
            if(data.status == 'success'){
                toastr.success(data.message);
                $(`#subscriber-${count}`).hide('slow');
            }else{
                toastr.error(data.message);
            }
        })
    }
</script>
{% endblock %}