{% extends "administrator/base.html" %}

{% block title %}
Videos
{% endblock %}

{% block CSS %}

{% endblock %}

{% block content %}
<div class="panel-heading">
	<h3 class="panel-title"><a href="javascript:void(0);" class="toggle-sidebar"><span class="fa fa-angle-double-left" data-toggle="offcanvas" title="Maximize Panel"></span></a>Pictures</h3>
</div>
<div class="panel-body">
	<div class="content-row">
		<div class = "row">
			<button class = "btn btn-info" data-toggle="modal" data-target="#addVideoModal">Add Video</button>
		</div>

        <div class="modal" id="addVideoModal">
            <div class="modal-dialog">
              <div class="modal-content">
          
                <!-- Modal Header -->
                <div class="modal-header">
                  <h4 class="modal-title">Add New Video</h4>
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
          
                <!-- Modal body -->
                <div class="modal-body">
                  <p class = "text-danger">Note: Only youtube video links are allowed</p>
                  
                    <div style = "margin-bottom:15px;">
                        <label>Video Title</label>
                        <input type = "text" name = "videoTitle" class = "form-control" id = "addVideoTitle">
                    </div>
                    <div style = "margin-bottom:15px;">
                      <label>Video Link</label>
                      <input type = "text" name = "videoLink" class = "form-control" placeholder = "ex: AyrDaWDxp4Y" id = "addVideoLink">
                    </div>
                  
                </div>
          
                <!-- Modal footer -->
                <div class="modal-footer">
                  <button type="button" class="btn btn-danger" data-dismiss="modal" id = "addVideoBtn">Save Changes</button>
                </div>
          
              </div>
            </div>
          </div>

        <hr>
		<div class = "row">
			@php foreach($videos as $video): @endphp
			<div class = "col-md-4" id = "video-{{$video->id}}">
                <iframe src="https://www.youtube.com/embed/{{$video->video_link}}" 
                    title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                allowfullscreen style = "width:100%;height:200px;">
                </iframe>
                <h6>{{$video->video_title}}</h6>
                <button class = "btn btn-danger btn-block" onclick = "confirmDeleteVideo('{{$video->id}}')" style = "float:right">
                    <span class = "glyphicon glyphicon-trash"></span>
                </button>
			</div>
			@php endforeach; @endphp
		</div>
		<hr>
	</div>
</div>
{% endblock %}

{% block JS %}
<script>
	function confirmDeleteVideo(video_id){
		confirmDelete = confirm("Do you really want to delete this video?");
		if(confirmDelete){
			url = "{% url deleteVideo %}"
			$.post(url, {'id':video_id}, function(response){
				const data = JSON.parse(response);
				console.log(data);
				if(data.status == 'success'){
					toastr.success(data.message);
					$(`#video-${video_id}`).hide('slow');
				}else{
					toastr.error(data.message);
				}
			})
		}
	}
</script>

<script>
    const videoBtn = $("#addVideoBtn");
    videoBtn.click(function(){
        const title = $("#addVideoTitle").val();
        const link = $("#addVideoLink").val();
        if(title.length > 0 && link.length > 0){
            url = "{% url addVideo %}";
            $.post(url, {'title':title, 'link':link}, function(response){
                const data = JSON.parse(response);
                if(data.status == 'success'){ 
                    toastr.success(data.message);
                    setTimeout(function(){window.location.reload()}, 3000)
                } 
                else{toastr.error(data.message);}
            })
        }else{
            toastr.error("Please fill the empty fields");
        }
    })
</script>
{% endblock %}